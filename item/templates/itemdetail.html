{% extends 'base.html' %}
{% block title %}{{ item.name }}{% endblock %}

{% block content %}
<br>
{% if request.user.is_authenticated and request.user == item.company or request.user.is_superuser %}
<ul class="nav nav-pills">
    <li class="nav-item">
        <form method="post">
            {% csrf_token %}
            <input type="submit" value="ناموجود" name="empty" class="btn btn-secondary">
        </form>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'item:update' item.slug item.pk %}">ویرایش</a>
    </li>
    {% if request.user.is_superuser %}
    <li class="nav-item">
        <form method="post">
            {% csrf_token %}
            <input type="submit" value="حذف محصول" name="deleteitem" class="btn btn-danger">
        </form>
    </li>
    {% endif %}
</ul><br><br>
{% endif %}
<div class="shadow-lg p-3 mb-5 bg-body rounded">
<div class="row row-cols-1 row-cols-md-3 g-4">
    <div class="col">
        <div class="card h-100" style="border-width:0">
            <div id="carouselExampleDark" class="carousel carousel-dark slide" data-bs-ride="carousel">
                <div class="carousel-indicators">
                
                {% for image in item.images.all %}
                    {% if forloop.counter0 == 0 %}
                        <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>    
                    {% else %}
                        <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="{{ forloop.counter0 }}" aria-label="Slide {{ forloop.counter0 }}"></button>
                    {% endif %}
                {% endfor %}
                </div>
                <div class="carousel-inner">
                {% for image in item.images.all %}
                    {% if forloop.counter == 1 %}
                        <div class="carousel-item active">
                            <img src="{{ image.image.url }}" class="d-block w-100" width="405.33">
                        </div>
                    {% else %}
                        <div class="carousel-item">
                            <img src="{{ image.image.url }}" class="d-block w-100" width="405.33">
                        </div>
                    {% endif %}
                {% endfor %}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleDark" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">قبلی</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleDark" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">بعدی</span>
                </button>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card h-100" style="border-width:0">
            <div class="card-body">
                <h2 class="card-title">{{ item.name }}</h2><hr>
                <h6 class="card-category">{{ item.category }}</h6>
                <p class="card-text">{{ item.body|safe|truncatechars:180 }}</p>
              </div>
        </div>
    </div>
    <div class="col" style="text-align:center;">
        <div class="card h-100" style="border-width:0">
            <div class="card" style="width: 18rem;">
                <div class="card-body">
                    <h5 class="card-title">فروشنده</h5><br>
                    <p>نام شرکت : {{ company_name}}</p>
                    <p>موجودی : {{ item.inventory }}</p>
                    <div class="col">
                        <p>رنگ ها : {% for color in item.color.all %}
                            <span class="dot" style="background-color: {{ color }};"></span>
                        {% endfor %}</p>
                    </div>
                    {% if item.inventory == 0 %}
                        <hr>
                        <h4 class="text-muted" id="namujud">ناموجود</h4>    
                    {% else %}
                        {% if item.discount %}
                            <p>قیمت : <s>{{ item.price_without_discount }}</s></p>
                            <p>تخفیف : {{ item.int_discount }}%</p>      
                        {% endif %}
                        <p>قیمت نهایی : {{ item.final_price }} تومان<p>
                        <button class="btn btn-success" id="buy-card">خرید</button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div><hr>
<div class="accordion" id="accordionExample">
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingOne">
        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
          مشحصات
        </button>
      </h2>
      <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
        <div class="accordion-body">
            {{ item.body|safe }}
        </div>
      </div>
</div>
<div style="padding-right:16px;"><br>
    <h3>دیدگاه ها</h3>
    {% for comment in item.comments.all %}
        {{ comment.user }}<br>
        {{ comment.date|date:"Y-m-d / H:i" }}<br>
        {{ comment.text|safe }}<br><hr>
    {% empty %}
        <p>هيچ ديدگاهي وجود ندارد</p>
    {% endfor %}

    {% if request.user.is_authenticated %}
        <form method="post">
            {% csrf_token %}
            {{ comment_form.media }}
            {{ comment_form.as_p }}
            <input type="submit" value="كامنت" name="comment" class="btn btn-primary">
        </form>
    {% else %}
        برای افزودن دیدگاه ابتدا <a href="{% url 'account:login' %}">وارد</a> شوید.
    {% endif %}
    <hr>

    {% if request.user.is_authenticated %}
    <form method="post">
        {% csrf_token %}
        {{ orderitem_form.as_p }}
        <input type="submit" value="افزودن به سبد" name="orderitem" class="btn btn-success">
    </form><br>
    {% else %}
    <form method="post">
        {% csrf_token %}
        <a href="{% url 'account:login' %}"><button type="button" class="btn btn-success">افزودن به سبد</button></a>
    </form><br>
    {% endif %}
</div>
</div>
{% endblock %}